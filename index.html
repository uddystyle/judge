<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>検定集計システム</title>
    <link rel="stylesheet" href="/style.css">
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <p id="header-main-text">初期化中...</p>
            <div class="info-display">
                <span>検定員: <b id="current-judge-display">--</b></span>
                <span>種別: <b id="current-discipline-display">--</b></span>
                <span>級: <b id="current-level-display">--</b></span>
                <span>種目: <b id="current-event-display">--</b></span>
            </div>
        </div>

        <div class="screen active" id="judge-screen">
            <div class="instruction" id="judge-instruction">利用可能な検定員を読み込んでいます...</div>
            <div class="list-keypad" id="judge-keypad"></div>
            <div class="nav-buttons">
                <button class="nav-btn primary" onclick="hardReset()">リストを更新</button>
                <button class="nav-btn danger" onclick="clearAllData()">データをクリア</button>
                <button class="nav-btn" onclick="exportAllResults()">全データをエクスポート</button>
            </div>
        </div>

        <div class="screen" id="discipline-screen">
            <div class="instruction">「種別」を選択してください</div>
            <div class="list-keypad" id="discipline-keypad"></div>
            <div class="nav-buttons"><button class="nav-btn" onclick="changeJudge()">検定員を変更</button></div>
        </div>

        <div class="screen" id="level-screen">
            <div class="instruction">検定する「級」を選択してください</div>
            <div class="list-keypad" id="level-keypad"></div>
            <div class="nav-buttons"><button class="nav-btn" onclick="goBackToDisciplineSelect()">種別の選択に戻る</button></div>
        </div>

        <div class="screen" id="event-screen">
            <div class="instruction">検定する「種目」を選択してください</div>
            <div class="list-keypad" id="event-keypad"></div>
            <div class="nav-buttons"><button class="nav-btn" onclick="goBackToLevelSelect()">級の選択に戻る</button></div>
        </div>

        <div class="screen" id="score-screen">
            <div class="numeric-display" id="score-display">0</div>
            <div class="numeric-keypad">
                <button class="numeric-key" onclick="inputNumber('7')">7</button><button class="numeric-key" onclick="inputNumber('8')">8</button><button class="numeric-key" onclick="inputNumber('9')">9</button>
                <button class="numeric-key" onclick="inputNumber('4')">4</button><button class="numeric-key" onclick="inputNumber('5')">5</button><button class="numeric-key" onclick="inputNumber('6')">6</button>
                <button class="numeric-key" onclick="inputNumber('1')">1</button><button class="numeric-key" onclick="inputNumber('2')">2</button><button class="numeric-key" onclick="inputNumber('3')">3</button>
                <button class="numeric-key" onclick="inputNumber('0')">0</button><button class="numeric-key spacer"></button>
                <button class="numeric-key clear" onclick="clearInput()">C</button>
                <button class="numeric-key confirm" onclick="confirmScore()">確定</button>
            </div>
            <div class="nav-buttons"><button class="nav-btn" onclick="changeEvent()">種目を変更</button></div>
        </div>

        <div class="screen" id="bib-screen">
            <div class="instruction">得点: <strong id="confirmed-score"></strong>点<br>ゼッケン番号を入力 (1-999番)</div>
            <div class="numeric-display" id="bib-display">0</div>
            <div class="numeric-keypad">
                <button class="numeric-key" onclick="inputBibNumber('7')">7</button><button class="numeric-key" onclick="inputBibNumber('8')">8</button><button class="numeric-key" onclick="inputBibNumber('9')">9</button>
                <button class="numeric-key" onclick="inputBibNumber('4')">4</button><button class="numeric-key" onclick="inputBibNumber('5')">5</button><button class="numeric-key" onclick="inputBibNumber('6')">6</button>
                <button class="numeric-key" onclick="inputBibNumber('1')">1</button><button class="numeric-key" onclick="inputBibNumber('2')">2</button><button class="numeric-key" onclick="inputBibNumber('3')">3</button>
                <button class="numeric-key" onclick="inputBibNumber('0')">0</button><button class="numeric-key spacer"></button>
                <button class="numeric-key clear" onclick="clearBibInput()">C</button>
                <button class="numeric-key confirm" onclick="confirmBib()">確定</button>
            </div>
            <div class="nav-buttons"><button class="nav-btn" onclick="goBack()">得点修正</button></div>
        </div>

        <div class="screen" id="submit-screen">
            <div class="instruction">採点内容の確認</div>
            <div class="status" style="text-align: left; max-width: 320px; margin: 20px auto; padding: 20px;">
                <p style="margin-bottom: 10px;"><strong>ゼッケン番号:</strong> <span id="final-bib"></span>番</p>
                <p><strong>得点:</strong> <span id="final-score"></span>点</p>
            </div>
            <div id="submit-status"></div>
            <div class="nav-buttons">
                <button class="nav-btn" onclick="editEntry()">修正する</button>
                <button class="nav-btn primary" onclick="submitEntry()">送信する</button>
            </div>
        </div>

        <div class="screen" id="complete-screen">
            <div class="instruction">送信完了</div>
            <div class="status">
                データが正常に送信されました<br>
                <strong>ゼッケン<span id="completed-bib"></span>番: <span id="completed-score"></span>点</strong>
            </div>
            <div class="nav-buttons">
                <button class="nav-btn primary" onclick="nextSkier()">次の滑走者</button>
            </div>
        </div>

        <div class="screen" id="confirm-screen">
            <div class="instruction" id="confirm-message"></div>
            <div class="nav-buttons">
                <button class="nav-btn primary" onclick="executeConfirm()">はい</button>
                <button class="nav-btn" onclick="cancelConfirm()">いいえ</button>
            </div>
        </div>

        <div class="loading-overlay" id="loading-overlay"><div class="loading"></div></div>
    </div>

    <script src="/script.js"></script>
</body>
</html>