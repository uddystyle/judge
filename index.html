<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>検定集計システム</title>
    <link rel="stylesheet" href="/style.css">
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <p id="header-main-text">ようこそ</p>
            <div class="info-display">
                <span id="user-info">ログインしていません</span> |
                <span id="session-info">検定未選択</span> |
                <span id="selection-info">選択中: ー</span>
                <span id="bib-info"></span>
            </div>
        </div>

        <div class="screen" id="landing-screen">
            <div class="hero-section">
                <h1>採点業務を、<br>スマホひとつでシンプルに。</h1>
                <p class="subtitle">リアルタイム集計で、検定会の運営をもっとスムーズにしませんか？</p>
            </div>
            <div class="features-section">
                <div class="feature-item"><span class="feature-icon">📲</span><h3>かんたん操作</h3><p>直感的なボタン操作で、誰でも迷わず採点できます。</p></div>
                <div class="feature-item"><span class="feature-icon">🔄</span><h3>リアルタイム共有</h3><p>採点結果は即座に集計。複数の検定員で同時に作業できます。</p></div>
                <div class="feature-item"><span class="feature-icon">📄</span><h3>ペーパーレス</h3><p>集計用紙への記入や計算は不要。ミスなく効率的に集計できます。</p></div>
            </div>
            <div class="nav-buttons">
                <button class="nav-btn primary" id="btn-landing-signup">無料で始める</button>
                <button class="nav-btn" id="btn-landing-login">ログイン</button>
            </div>
        </div>

        <div class="screen" id="login-screen">
            <div class="instruction">ログイン</div>
            <div class="form-container">
                <input type="email" id="login-email" placeholder="メールアドレス" autocomplete="email">
                <input type="password" id="login-password" placeholder="パスワード" autocomplete="current-password">
                <div class="nav-buttons">
                    <button class="nav-btn primary" id="btn-login">ログイン</button>
                    <button class="nav-btn" id="btn-goto-signup">新規登録はこちら</button>
                </div>
                <div id="login-error-message"></div>
            </div>
        </div>

        <div class="screen" id="signup-screen">
            <div class="instruction">新規アカウント登録</div>
            <div class="form-container">
                <input type="text" id="signup-name" placeholder="氏名" autocomplete="name">
                <input type="email" id="signup-email" placeholder="メールアドレス" autocomplete="email">
                <input type="password" id="signup-password" placeholder="パスワード (6文字以上)" autocomplete="new-password">
                <div class="nav-buttons">
                    <button class="nav-btn primary" id="btn-signup">登録する</button>
                    <button class="nav-btn" id="btn-back-to-login">ログイン画面に戻る</button>
                </div>
            </div>
        </div>

        <div class="screen" id="dashboard-screen">
            <div class="list-keypad" id="session-list"></div>
            <div class="nav-buttons">
                <button class="nav-btn primary" id="btn-goto-create-session">新しい検定を作成</button>
                <button class="nav-btn" id="btn-goto-join-session">コードで参加</button>
                <button class="nav-btn" id="btn-goto-account">アカウント設定</button>
                <button class="nav-btn danger" id="btn-logout">ログアウト</button>
            </div>
        </div>

        <div class="screen" id="create-session-screen">
            <div class="instruction">新しい検定を作成</div>
            <div class="form-container">
                <input type="text" id="session-name-input" placeholder="検定名 (例: 2025冬期検定)">
                <div class="nav-buttons">
                    <button class="nav-btn primary" id="btn-create-session">作成</button>
                    <button class="nav-btn" id="btn-create-back-to-dash">戻る</button>
                </div>
            </div>
        </div>

        <div class="screen" id="join-session-screen">
            <div class="instruction">参加コードで合流</div>
            <div class="form-container">
                <input type="text" id="join-code-input" placeholder="6桁の参加コード" maxlength="6" style="text-transform: uppercase;">
                <div class="nav-buttons">
                    <button class="nav-btn primary" id="btn-join-session">参加</button>
                    <button class="nav-btn" id="btn-join-back-to-dash">戻る</button>
                </div>
            </div>
        </div>

        <div class="screen" id="judge-wait-screen">
            <div class="instruction">準備中…</div>
            <div style="margin: 24px 0; color: var(--secondary-text); line-height: 1.6;">
                <p>主任検定員が採点の準備をしています。</p>
                <p>しばらくお待ちください。</p>
            </div>
            <div class="loading"></div>
            <div class="nav-buttons" style="margin-top: 40px;">
                <button class="nav-btn" id="btn-wait-back-to-dash">検定選択に戻る</button>
            </div>
        </div>

        <div class="screen" id="discipline-screen">
            <div class="list-keypad" id="discipline-keypad"></div>
            <div class="nav-buttons"><button class="nav-btn" id="btn-discipline-back-to-dash">検定選択に戻る</button></div>
        </div>

        <div class="screen" id="level-screen">
            <div class="list-keypad" id="level-keypad"></div>
            <div class="nav-buttons"><button class="nav-btn" id="btn-level-back-to-discipline">種別の選択に戻る</button></div>
        </div>

        <div class="screen" id="event-screen">
            <div class="list-keypad" id="event-keypad"></div>
            <div class="nav-buttons"><button class="nav-btn" id="btn-event-back-to-level">級の選択に戻る</button></div>
        </div>

        <div class="screen" id="score-screen">
            <div class="numeric-display" id="score-display">0</div>
            <div class="numeric-keypad" id="score-keypad">
                <button class="numeric-key" data-value="7">7</button><button class="numeric-key" data-value="8">8</button><button class="numeric-key" data-value="9">9</button>
                <button class="numeric-key" data-value="4">4</button><button class="numeric-key" data-value="5">5</button><button class="numeric-key" data-value="6">6</button>
                <button class="numeric-key" data-value="1">1</button><button class="numeric-key" data-value="2">2</button><button class="numeric-key" data-value="3">3</button>
                <button class="numeric-key" data-value="0">0</button><button class="numeric-key spacer"></button>
                <button class="numeric-key clear" id="btn-score-clear">C</button>
                <button class="numeric-key confirm" id="btn-score-confirm">確定</button>
            </div>
            <div class="nav-buttons"><button class="nav-btn" id="btn-score-back-to-bib">ゼッケンを修正</button></div>
        </div>

        <div class="screen" id="bib-screen">
            <div class="numeric-display" id="bib-display">0</div>
            <div class="numeric-keypad" id="bib-keypad">
                <button class="numeric-key" data-value="7">7</button><button class="numeric-key" data-value="8">8</button><button class="numeric-key" data-value="9">9</button>
                <button class="numeric-key" data-value="4">4</button><button class="numeric-key" data-value="5">5</button><button class="numeric-key" data-value="6">6</button>
                <button class="numeric-key" data-value="1">1</button><button class="numeric-key" data-value="2">2</button><button class="numeric-key" data-value="3">3</button>
                <button class="numeric-key" data-value="0">0</button><button class="numeric-key spacer"></button>
                <button class="numeric-key clear" id="btn-bib-clear">C</button>
                <button class="numeric-key confirm" id="btn-bib-confirm">確定</button>
            </div>
            <div class="nav-buttons"><button class="nav-btn" id="btn-bib-back-to-event">種目を変更</button></div>
        </div>

        <div class="screen" id="submit-screen">
            <div class="instruction">採点内容の確認</div>
            <div class="status" style="text-align: left; max-width: 320px; margin: 20px auto; padding: 20px;">
                <p style="margin-bottom: 10px;"><strong>ゼッケン番号:</strong> <span id="final-bib"></span>番</p>
                <p><strong>得点:</strong> <span id="final-score"></span>点</p>
            </div>
            <div id="submit-status"></div>
            <div class="nav-buttons">
                <button class="nav-btn" id="btn-edit-entry">修正する</button>
                <button class="nav-btn primary" id="btn-submit-entry">送信する</button>
            </div>
        </div>

        <div class="screen" id="complete-screen">
            <div class="instruction">送信完了</div>
            <div class="status">
                データが正常に送信されました<br>
                <strong>ゼッケン<span id="completed-bib"></span>番: <span id="completed-score"></span>点</strong>
            </div>
            <div class="nav-buttons">
                <button class="nav-btn primary" id="btn-next-skier">次の滑走者</button>
                <button class="nav-btn" id="share-button-complete">結果を共有</button>
            </div>
        </div>
        <div class="screen" id="confirm-screen">
            <div class="instruction" id="confirm-message"></div>
            <div class="nav-buttons">
                <button class="nav-btn primary" id="btn-confirm-yes">はい</button>
                <button class="nav-btn" id="btn-confirm-no">いいえ</button>
            </div>
        </div>

        <div class="screen" id="account-screen">
            <div class="instruction">アカウント設定</div>
            <div class="form-container">
                <label for="account-name" class="form-label">氏名</label>
                <input type="text" id="account-name" placeholder="氏名" autocomplete="name">
                <div class="nav-buttons" style="margin-top: 0;">
                    <button class="nav-btn primary" id="btn-update-name">名前を更新</button>
                </div>
            </div>
            <hr class="divider">
            <div class="form-container">
                <label for="account-password" class="form-label">新しいパスワード</label>
                <input type="password" id="account-password" placeholder="新しいパスワード (6文字以上)" autocomplete="new-password">
                <input type="password" id="account-password-confirm" placeholder="新しいパスワード (確認)" autocomplete="new-password">
                <div class="nav-buttons" style="margin-top: 0;">
                    <button class="nav-btn primary" id="btn-update-password">パスワードを更新</button>
                </div>
            </div>
            <div class="nav-buttons">
                <button class="nav-btn danger" id="btn-goto-delete-account">アカウントを削除</button>
                <button class="nav-btn" id="btn-account-back-to-dash">検定選択に戻る</button>
            </div>
        </div>

        <div class="screen" id="delete-confirm-screen">
            <div class="instruction">本当にアカウントを削除しますか？</div>
            <div style="margin-bottom: 24px; color: var(--secondary-text);">
                この操作は取り消せません。作成した検定や採点データを含む、すべてのアカウント情報が完全に削除されます。
            </div>
            <div class="nav-buttons">
                <button class="nav-btn danger" id="btn-delete-account">はい、削除します</button>
                <button class="nav-btn" id="btn-delete-account-cancel">いいえ、キャンセルします</button>
            </div>
        </div>

        <div class="screen" id="session-details-screen">
            <div class="instruction" id="session-details-title">検定の詳細</div>

            <div class="form-container">
                <label for="session-details-name" class="form-label">検定名</label>
                <input type="text" id="session-details-name" placeholder="検定名">
            </div>

            <hr class="divider">

            <div class="settings-section">
                <h3 class="settings-title">採点ルール設定</h3>
                <div class="setting-item">
                    <label for="multi-judge-toggle" class="form-label">複数審判モード</label>
                    <div class="toggle-switch">
                        <input type="checkbox" id="multi-judge-toggle">
                        <label for="multi-judge-toggle"></label>
                    </div>
                </div>
                <div class="setting-item" id="required-judges-container" style="display: none;">
                    <label for="required-judges-input" class="form-label">必須審判員数</label>
                    <input type="number" id="required-judges-input" min="1" value="1" class="short-input">
                </div>
            </div>

            <hr class="divider">

            <div class="settings-section">
                <h3 class="settings-title">参加中の検定員</h3>
                <div id="session-participants-list" class="participants-container">
                    </div>
            </div>

            <hr class="divider">

            <div class="nav-buttons">
                <button class="nav-btn primary" id="btn-save-session-settings">設定を保存</button>
            </div>

            <div class="nav-buttons">
                <button class="nav-btn danger" id="btn-goto-delete-session">この検定を削除</button>
                <button class="nav-btn" id="btn-details-back-to-dash">検定選択に戻る</button>
            </div>
        </div>

        <div class="screen" id="delete-session-confirm-screen">
            <div class="instruction">本当にこの検定を削除しますか？</div>
            <div style="margin-bottom: 24px; color: var(--secondary-text);">
                この操作は取り消せません。この検定に関連する全ての採点データが完全に削除されます。
            </div>
            <div class="nav-buttons">
                <button class="nav-btn danger" id="btn-delete-session">はい、削除します</button>
                <button class="nav-btn" id="btn-delete-session-cancel">いいえ、キャンセルします</button>
            </div>
        </div>

        <div class="loading-overlay" id="loading-overlay"><div class="loading"></div></div>
    </div>
    <script type="module" src="/scripts/main.js"></script>
</body>
</html>